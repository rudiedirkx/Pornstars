<?

include("config.php");

logincheck();

// productionarray: soort(naam,uitleg,eta,metal,crystal,rescon_nodig)
$productionarray =array('infinitys'=>array('Infinitys','Small weak ships who make up their little powers with their agility and speed.','10','0','300','c_pinf'),
			'wraiths'=>array('Wraiths','Slightly bigger ships with slower though stronger weapons. Also high agility and speed.','20','1000','0','c_pwra'),
			'warfrigs'=>array('Warfrigates','Warfrigates are real warships! Big ships loaded with lowspeed cannons and highspeed machineguns.','40','2500','2500','r_pwarast'),
			'astropods'=>array('Astropods','The Astropod is the only ship that can steal roids from others. Astropods are slow and weak and cant shoot. They die on success.','40','1250','1250','r_pwarast'),
			'cobras'=>array('Cobras','Very strong and armoured ships! Blocks but not kills Astropods. A musthave in the modern army!','60','0','3000','r_pcob'),
			'destroyers'=>array('Destroyers','The biggest of all heavy duty warships! Quite an investment, but very efficient in combat!','60','2000','3000','c_pdes'),
			'scorpions'=>array('Scorpion','Great ships, <u>very stealth</u> and quite manouvrable and fast. A Cobra\'s worst enemy!','100','6000','1000','c_psco'),
			'a',
			'rcannons'=>array('Reaper Cannons','Best PDU against Astropods. This unit is a musthave in your Planetary Defense!','20','1000','0','c_pdu1'),
			'avengers'=>array('Avengers','Avengers are of a new generation of PDU. They select their targets and are therefore very efficient!','30','800','800','c_pdu1'),
			'lstalkers'=>array('Lucius Stalkers','Very heavy Defense Unit, which can only be killed by Wraiths. Lucius Stalkers go for the big fish of the attacker!','60','3000','3000','c_pdu2'));


$a=$_GET[aantal];
$t=$_GET[type];
if ($_GET[check] && $t && $a)
{
	$eta = $productionarray[$t][2];
	$km = $productionarray[$t][3];
	$kc = $productionarray[$t][4];
	$need = $productionarray[$t][5];
	if ($a*$km>$metal || $a*$kc>$crystal)
	{
		$na[m]=($km)?floor($metal/$km):9999999;
		$na[c]=($kc)?floor($crystal/$kc):9999999;
		$a = min($na);
	}
	$a=min($a,9999999);

	$sql = "UPDATE $TABLE[users] SET p_".$type."='$a', p_".$type."t='".($eta+1)."', crystal=crystal-".($kc*$a).", metal=metal-".($km*$a)." WHERE id='$UID' AND metal>=".($km*$a)." AND crystal>=".($kc*$a)." AND p_".$type."=0 AND $need=1";
	mysql_query($sql);
	$affected = mysql_affected_rows();
	$msg = ($affected) ? "green=Done" : "red=Not done";

	Header("Location: ?msg".$msg);
	exit();
}


require "header.php";

?>

<table border=0 cellpadding=2 cellspacing=0 width=100%>
<tr><td style='border:solid 1px black;'><center><b>Units</b></td></tr>
</table>
<br>

<table border=1 bordercolor=#dddddd cellpadding=5 cellspacing=2 width=100% style='border:0;'>
<?

Production_entry("Name:","<b>Description:","<b>ETA:","<b>Cost:","<b>Stock:","Production:");

$myrow = mysql_fetch_assoc(mysql_query("SELECT * FROM $TABLE[users] WHERE id='$UID'"));

// Voor als je aan t bouwen bent (ETA en aantal)
$p_infinitys	= $myrow[p_infinitys];
$p_infinityst	= $myrow[p_infinityst];
$p_wraiths	= $myrow[p_wraiths];
$p_wraithst	= $myrow[p_wraithst];
$p_cobras	= $myrow[p_cobras];
$p_cobrast	= $myrow[p_cobrast];
$p_warfrigs	= $myrow[p_warfrigs];
$p_warfrigst	= $myrow[p_warfrigst];
$p_astropods	= $myrow[p_astropods];
$p_astropodst	= $myrow[p_astropodst];
$p_destroyers	= $myrow[p_destroyers];
$p_destroyerst	= $myrow[p_destroyerst];
$p_scorpions	= $myrow[p_scorpions];
$p_scorpionst	= $myrow[p_scorpionst];
$p_rcannons	= $myrow[p_rcannons];
$p_rcannonst	= $myrow[p_rcannonst];
$p_avengers	= $myrow[p_avengers];
$p_avengerst	= $myrow[p_avengerst];
$p_lstalkers	= $myrow[p_lstalkers];
$p_lstalkerst	= $myrow[p_lstalkerst];

// Stock
$infinitys	= $infinitys_fleet + $infinitys_base;
$wraiths	= $wraiths_fleet + $wraiths_base;
$warfrigs	= $warfrigs_fleet + $warfrigs_base;
$destroyers	= $destroyers_fleet + $destroyers_base;
$cobras		= $cobras_fleet + $cobras_base;
$astropods	= $astropods_fleet + $astropods_base;
$scorpions	= $scorpions_fleet + $scorpions_base;
$avengers	= $avengers;
$rcannons	= $rcannons;
$lstalkers	= $lstalkers;





foreach ($productionarray AS $soort => $inhoud)
{
	if (strlen($soort)==1)
	{
		echo "<tr height=5 bgcolor=black><td colspan=6></td></tr>\n";
	}
	else
	{
		$cn = "p_".$soort;
		$production = ($$cn == 0) ? "<table border=0 cellpadding=0 cellspacing=0><form action=production.php><input type=hidden name=check value=1><input type=hidden name=type value=\"$soort\"><input type=hidden name=km value=$inhoud[3]><input type=hidden name=kc value=$inhoud[4]><tr><td><center><input type=text name=aantal style='width:60;text-align:center;' autocomplete=off><br><input type=submit value=\"Order\"></td></tr></form></table>" : "Building<br>".$$cn;
		$eta = ($$cn == 0) ? $inhoud[2] : "<b>".(${$cn.t}-1);
		if ($$inhoud[5] == 1)
		{
			Production_Entry($inhoud[0],$inhoud[1],$eta,"$inhoud[3] metal<br>$inhoud[4] crystal",$$soort,$production);
		}
	}
}





echo "</table><br>";


